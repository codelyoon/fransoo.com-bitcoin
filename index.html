<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>fransoo.com | BTC Live</title>
  <style>
    body {background:#000;color:#00bfff;font-family:'Courier New',monospace;margin:0;overflow:hidden;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}
    #static-canvas {position:absolute;top:0;left:0;width:100%;height:100%;opacity:0.15;pointer-events:none;z-index:1}
    .container {z-index:2;text-align:center;max-width:900px;width:100%;padding:20px;box-sizing:border-box}
    .typing {font-size:20px;white-space:pre-line}
    .cursor {display:inline-block;width:10px;height:22px;background:#00bfff;animation:blink 1s infinite;vertical-align:middle}
    @keyframes blink {0%,50%{opacity:1}51%,100%{opacity:0}}
    #price-box {position:absolute;top:20px;right:20px;font-size:28px;font-weight:bold;letter-spacing:1px;z-index:3}
    .up {color:#00ff00}
    .down {color:#ff0044}
    #chart-container {margin-top:50px;width:100%;height:50vh;background:#000;border:1px solid #00bfff;box-sizing:border-box}
    canvas#chart {width:100%;height:100%}
  </style>
</head>
<body>
  <canvas id="static-canvas"></canvas>
  <div id="price-box">BTC $--.---</div>
  <div class="container">
    <div class="typing" id="typing"></div>
    <div id="chart-container"><canvas id="chart"></canvas></div>
  </div>

  <script>
    // Static noise
    const sc = document.getElementById('static-canvas');
    const sctx = sc.getContext('2d');
    sc.width = innerWidth; sc.height = innerHeight;
    window.addEventListener('resize',()=>{sc.width=innerWidth;sc.height=innerHeight});
    (function noise(){const d=sctx.createImageData(sc.width,sc.height);const b=new Uint32Array(d.data.buffer);
      for(let i=0;i<b.length;i++)if(Math.random()<0.09)b[i]=0x33ffffff;sctx.putImageData(d,0,0);requestAnimationFrame(noise);})();

    const intro = `hi, i'm Henry Fransoo

live BTC 24h chart drawing right now
fransoo.com`;
    
    const typingEl = document.getElementById('typing');
    const priceBox = document.getElementById('price-box');
    const chartCanvas = document.getElementById('chart');
    const ctx = chartCanvas.getContext('2d');

    function type(text, el, cb) {
      let i=0;
      const int = setInterval(()=>{
        if(i<text.length){el.innerHTML += text[i]==='\n'?'<br>':text[i];i++}
        else{clearInterval(int);if(cb)cb()}
      },45);
    }

    type(intro, typingEl, ()=>typingEl.innerHTML += '<span class="cursor"></span>');

    // Resize chart canvas properly
    function resizeChart() {
      chartCanvas.width = chartCanvas.offsetWidth * devicePixelRatio;
      chartCanvas.height = chartCanvas.offsetHeight * devicePixelRatio;
      ctx.scale(devicePixelRatio, devicePixelRatio);
    }
    window.addEventListener('resize', resizeChart);
    resizeChart();

    let prices = [];
    let currentPrice = 0;
    let change24h = 0;

    async function fetchBTC() {
      try {
        // Current price
        const res1 = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true', {
          headers: {'accept': 'application/json'}
        });
        const data = await res1.json();
        currentPrice = data.bitcoin.usd;
        change24h = data.bitcoin.usd_24h_change;

        priceBox.innerHTML = `BTC $${currentPrice.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:0})} 
          <span class="${change24h>=0?'up':'down'}">${change24h>=0?'↑':'↓'}${Math.abs(change24h).toFixed(2)}%</span>`;

        // 24h hourly data
        const res2 = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=1&interval=hourly');
        const hist = await res2.json();
        prices = hist.prices.map(p => p[1]);

        drawChart();
      } catch(e) {
        priceBox.textContent = "API down – still stacking";
      }
    }

    function drawChart() {
      resizeChart();
      ctx.clearRect(0,0,chartCanvas.width,chartCanvas.height);

      const w = chartCanvas.offsetWidth;
      const h = chartCanvas.offsetHeight;
      const pad = 50;

      const maxP = Math
