<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>fransoo.com | Crypto Portal</title>
<style>
  body{background:#000;color:#00bfff;font-family:'Courier New',monospace;margin:0;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden}
  #static{position:absolute;inset:0;opacity:0.15;pointer-events:none;z-index:1}
  .container{z-index:2;width:100%;max-width:1100px;padding:10px 15px;box-sizing:border-box;display:flex;flex-direction:column;align-items:center;gap:10px}
  .typing{font-size:clamp(15px,4vw,21px);text-align:center;margin-bottom:5px;white-space:pre-line}
  .cursor{display:inline-block;width:8px;height:1.1em;background:#00bfff;animation:b 1s infinite}
  @keyframes b{0%,50%{opacity:1}51%,100%{opacity:0}}

  #price-box{display:flex;align-items:center;gap:15px;font-size:clamp(28px,8vw,44px);font-weight:bold;position:relative}
  #coin-display{font-weight:bold;color:#00bfff}
  #coin-select{position:absolute;inset:0;opacity:0;cursor:pointer}
  <span id="price-live">Loading...</span>
  #price-live{transition:background 0.4s;text-shadow:0 0 15px #00bfff}
  .pulse-green{background:rgba(0,255,0,0.3)!important}
  .pulse-red{background:rgba(255,0,0,0.3)!important}
  .up{color:#0f8}.down{color:#f44}

  #chart-container{position:relative;width:100%;height:58vh;border:1px solid #00bfff;background:#000;border-radius:8px;overflow:hidden;cursor:crosshair}
  canvas{width:100%!important;height:100%!important;display:block}
  #tf-select{position:absolute;top:10px;left:10px;z-index:10;background:#000;border:1px solid #00bfff;color:#00bfff;padding:8px 16px;font-size:15px;border-radius:6px;outline:none}
  #change{font-size:clamp(16px,4.5vw,22px);font-weight:bold;margin-top:5px}

  #hover-price{
    position:absolute;z-index:20;color:#00bfff;font:bold 15px monospace;
    background:rgba(0,0,0,0.85);padding:8px 14px;border-radius:8px;
    border:1px solid #00bfff;box-shadow:0 0 20px #00bfff;pointer-events:none;
    opacity:0;transition:opacity 0.12s;white-space:nowrap;
    transform:translateX(-50%); /* Perfect centering */
    left:0;top:0;display:none;
  }
  @media (min-width: 769px) {#hover-price{display:block}}

  @media (max-width: 768px) {
    .container{padding:10px 8px;gap:8px}
    #price-box{gap:10px;font-size:clamp(26px,9vw,38px)}
    #chart-container{height:55vh;cursor:default}
    #tf-select{font-size:14px;padding:7px 14px}
    #change{font-size:18px}
  }
</style>
</head>
<body>
<canvas id="static"></canvas>

<div class="container">
  <div class="typing" id="typing"></div>
  
  <div id="price-box">
    <div id="coin-display">BTC</div>
    <select id="coin-select"></select>
    <span id="price-live">Loading...</span>
  </div>

  <div id="chart-container">
    <select id="tf-select">
      <option value="live">LIVE</option>
      <option value="1h">1H</option>
      <option value="1d">1D</option>
      <option value="7d" selected>7D</option>
      <option value="30d">30D</option>
      <option value="ytd">YTD</option>
      <option value="all">ALL</option>
    </select>
    <canvas id="c"></canvas>
    <div id="hover-price"></div>
  </div>
  
  <div id="change">Loading...</div>
</div>

<script>
// Static + typing (unchanged)
const s=document.getElementById('static'),ctx2=s.getContext('2d');
s.width=innerWidth;s.height=innerHeight;
window.addEventListener('resize',()=>{s.width=innerWidth;s.height=innerHeight});
(function n(){const i=ctx2.createImageData(s.width,s.height),d=new Uint32Array(i.data.buffer);
for(let j=0;j<d.length;j++)if(Math.random()<0.09)d[j]=0x33ffffff;ctx2.putImageData(i,0,0);requestAnimationFrame(n)})();

const intro=`welcome to the fransoo.com crypto portal

live charts • top 30 coins • real-time`;
const typing=document.getElementById('typing');
let i=0;
const ti=setInterval(()=>{if(i<intro.length){typing.innerHTML+=intro[i]==='\n'?'<br>':intro[i];i++}
else{clearInterval(ti);typing.innerHTML+='<span class="cursor"></span>'}},45);

const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
const priceLive=document.getElementById('price-live');
const changeEl=document.getElementById('change');
const coinDisplay=document.getElementById('coin-display');
const coinSel=document.getElementById('coin-select');
const tfSel=document.getElementById('tf-select');
const hoverPrice = document.getElementById('hover-price');

let currentSymbol = 'BTCUSDT';
let currentName = 'BTC';
let lastPrice = 0;
let chartData = {prices: [], times: []};
let lastCandleTime = 0;
let currentTf = '7d';

// ... (all other code unchanged until hover section)

function drawChart(prices, times, tf, endDotColor = '#00bfff'){
  resize();
  const W=canvas.width/devicePixelRatio, H=canvas.height/devicePixelRatio;
  ctx.clearRect(0,0,W,H);
  if(prices.length<2) return;

  const padX=65, padY=45, chartWidth=W-padX-85, chartHeight=H-90;
  const max=Math.max(...prices), min=Math.min(...prices), range=max-min||1;

  // Area + Line
  ctx.fillStyle='rgba(0,191,255,0.12)';
  ctx.beginPath();
  prices.forEach((p,i)=>{const x=padX+i*(chartWidth/(prices.length-1));
    const y=H-padY-((p-min)/range)*chartHeight;
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});
  ctx.lineTo(W-85,H-padY);ctx.lineTo(padX,H-padY);ctx.closePath();ctx.fill();

  ctx.strokeStyle='#00bfff';ctx.lineWidth=2.5;ctx.beginPath();
  prices.forEach((p,i)=>{const x=padX+i*(chartWidth/(prices.length-1));
    const y=H-padY-((p-min)/range)*chartHeight;
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});
  ctx.stroke();

  // Live end dot
  const lastX = padX + (prices.length-1)*(chartWidth/(prices.length-1));
  const lastY = H-padY-((prices[prices.length-1]-min)/range)*chartHeight;
  ctx.fillStyle = endDotColor;
  ctx.beginPath(); ctx.arc(lastX, lastY, 8, 0, Math.PI*2); ctx.fill();
  ctx.strokeStyle = '#00bfff'; ctx.lineWidth = 2.5; ctx.stroke();

  // Grid + Price Axis + Time Labels (unchanged)
  ctx.strokeStyle='#003340';
  for(let i=0;i<=5;i++){
    const y=padY+i*(chartHeight/5);
    ctx.beginPath();ctx.moveTo(padX,y);ctx.lineTo(W-85,y);ctx.stroke();
  }
  ctx.fillStyle='#00bfff';ctx.font='14px monospace';ctx.textAlign='right';
  for(let i=0;i<=5;i++){
    const val=max-i*(range/5);
    const y=padY+i*(chartHeight/5);
    ctx.fillText('$' + val.toFixed(val>1000?0:2).replace(/\B(?=(\d{3})+(?!\d))/g, ','), W-15, y+5);
  }
  if(tf!=='live'){
    ctx.textAlign='center';ctx.font='13px monospace';
    const count=innerWidth<=768?4:7;
    for(let i=0;i<=count;i++){
      const idx=Math.round(i*(prices.length-1)/count);
      const x=padX+idx*(chartWidth/(prices.length-1));
      const d=times[idx];
      let label=tf==='1h'?d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'}).replace(/:\d\d$/,''):
                  tf==='1d'?d.getHours()+'h':
                  tf==='7d'||tf==='30d'?d.toLocaleDateString('en-US',{month:'short',day:'numeric'}):
                  tf==='ytd'?d.toLocaleDateString('en-US',{month:'short'}):d.getFullYear();
      ctx.fillText(label,x,H-padY+25);
    }
  }
  ctx.strokeStyle='#00bfff';ctx.lineWidth=1.8;
  ctx.strokeRect(padX,padY,chartWidth,chartHeight);
}

// HOVER TRACKING — NOW 100% PIXEL-PERFECT & CENTERED
canvas.addEventListener('mousemove', e => {
  if(innerWidth <= 768) return;
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  const W = canvas.width/devicePixelRatio;
  const H = canvas.height/devicePixelRatio;
  const padX=65, chartWidth=W-padX-85, chartHeight=H-90;

  if(mouseX < padX || mouseX > W-85 || mouseY < 45 || mouseY > H-45){
    hoverPrice.style.opacity = '0';
    drawChart(chartData.prices, chartData.times, currentTf);
    return;
  }

  const prices = chartData.prices;
  if(prices.length < 2) return;

  const max=Math.max(...prices), min=Math.min(...prices), range=max-min||1;
  const fraction = (mouseX - padX) / chartWidth;
  const index = Math.round(fraction * (prices.length - 1));
  if(index < 0 || index >= prices.length) return;

  const price = prices[index];
  const pointX = padX + index * (chartWidth / (prices.length - 1));
  const pointY = H - 45 - ((price - min) / range) * chartHeight;

  // Redraw base chart
  drawChart(prices, chartData.times, currentTf);

  // Hover dot
  ctx.fillStyle = '#00ffff';
  ctx.beginPath(); ctx.arc(pointX, pointY, 7, 0, Math.PI*2); ctx.fill();
  ctx.strokeStyle = '#00bfff'; ctx.lineWidth = 3; ctx.stroke();

  // Floating price — PERFECTLY centered above dot
  hoverPrice.textContent = `$${price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
  hoverPrice.style.left = `${pointX}px`;
  hoverPrice.style.top = `${pointY - 34}px`;
  hoverPrice.style.opacity = '1';
});

canvas.addEventListener('mouseout', () => {
  hoverPrice.style.opacity = '0';
  drawChart(chartData.prices, chartData.times, currentTf);
});

// Events + Init (unchanged)
coinSel.onchange = () => {
  const opt = coinSel.options[coinSel.selectedIndex];
  currentSymbol = coinSel.value;
  currentName = opt.textContent.split(' ')[0];
  coinDisplay.textContent = currentName;
  lastPrice = 0; chartData = {prices: [], times: []}; lastCandleTime = 0;
  loadChart(tfSel.value);
};
tfSel.onchange = () => loadChart(tfSel.value);

async function init(){
  coinSel.innerHTML = '';
  top30.forEach(coin => {
    const opt = document.createElement('option');
    opt.value = coin.s;
    opt.textContent = `${coin.n} Loading...`;
    if(coin.s===currentSymbol) opt.selected = true;
    coinSel.appendChild(opt);
  });
  updateDropdown();
  loadChart('7d');
}
init();

setInterval(updateLive, 3000);
setInterval(updateDropdown, 60000);
</script>
</body>
</html>
