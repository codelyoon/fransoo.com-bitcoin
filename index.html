<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>fransoo.com | Finance Portal</title>
<style>
  body{background:#000;color:#00bfff;font-family:'Courier New',monospace;margin:0;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden}
  #static{position:absolute;inset:0;opacity:0.15;pointer-events:none;z-index:1}
  .container{z-index:2;text-align:center;padding:20px;width:100%;max-width:1000px;box-sizing:border-box}
  .typing{font-size:20px;white-space:pre-line}
  .cursor{display:inline-block;width:10px;height:22px;background:#00bfff;animation:b 1s infinite}
  @keyframes b{0%,50%{opacity:1}51%,100%{opacity:0}}
  #price-live{position:absolute;top:8px;left:50%;transform:translateX(-50%);font-size:32px;font-weight:bold;z-index:10;letter-spacing:1px;text-shadow:0 0 10px #00bfff}
  .up{color:#0f8}.down{color:#f44}
  #chart-container{position:relative;margin-top:60px;width:100%;height:60vh;border:1px solid #00bfff}
  canvas{width:100%;height:100%;display:block}
  select{position:absolute;top:-45px;left:12px;z-index:3;background:#000;border:1px solid #00bfff;color:#00bfff;padding:8px 16px;font-size:15px;font-family:inherit}
  #change{font-size:19px;margin-top:12px;opacity:0.9;font-weight:bold}
</style>
</head>
<body>
<canvas id="static"></canvas>

<div id="price-live">BTC $--.---</div>

<div class="container">
  <div class="typing" id="typing"></div>
  <div id="chart-container">
    <select id="tf">
      <option value="1h">1H</option>
      <option value="1d">1D</option>
      <option value="7d" selected>7D</option>
      <option value="30d">30D</option>
      <option value="ytd">YTD</option>
      <option value="all">ALL</option>
    </select>
    <canvas id="c"></canvas>
  </div>
  <div id="change"></div>
</div>

<script>
// Static noise
const s = document.getElementById('static'), ctx2 = s.getContext('2d');
s.width = innerWidth; s.height = innerHeight;
window.addEventListener('resize', () => { s.width = innerWidth; s.height = innerHeight; });
(function n() {
  const img = ctx2.createImageData(s.width, s.height);
  const buf = new Uint32Array(img.data.buffer);
  for (let i = 0; i < buf.length; i++) if (Math.random() < 0.09) buf[i] = 0x33ffffff;
  ctx2.putImageData(img, 0, 0);
  requestAnimationFrame(n);
})();

// Typing
const intro = `welcome to the fransoo.com finance portal

here's the live BTC chart & price`;
const typing = document.getElementById('typing');
let i = 0;
const ti = setInterval(() => {
  if (i < intro.length) { typing.innerHTML += intro[i] === '\n' ? '<br>' : intro[i]; i++; }
  else { clearInterval(ti); typing.innerHTML += '<span class="cursor"></span>'; }
}, 45);

// Chart
const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
const priceLive = document.getElementById('price-live');
const changeEl = document.getElementById('change');
const sel = document.getElementById('tf');

function resize() {
  canvas.width = canvas.offsetWidth * devicePixelRatio;
  canvas.height = canvas.offsetHeight * devicePixelRatio;
  ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
}
window.addEventListener('resize', resize);
resize();

async function updatePrice() {
  try {
    const r = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT');
    const d = await r.json();
    const p = +d.lastPrice, ch = +d.priceChangePercent;
    priceLive.innerHTML = `BTC $${p.toLocaleString('en-US',{minimumFractionDigits:0,maximumFractionDigits:0})} <span class="${ch>=0?'up':'down'}">${ch>=0?'+' : '−'}${Math.abs(ch).toFixed(2)}%</span>`;
  } catch { priceLive.textContent = "BTC --"; }
}

async function load(tf) {
  let interval, limit;
  if (tf === '1h')   { interval = '1m';  limit = 60; }
  else if (tf === '1d')   { interval = '5m';  limit = 288; }
  else if (tf === '7d')   { interval = '1h';  limit = 168; }
  else if (tf === '30d')  { interval = '4h';  limit = 180; }
  else if (tf === 'ytd')  { interval = '1d';  limit = 365; }
  else { interval = '1w'; limit = 1000; }

  const r = await fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${interval}&limit=${limit}`);
  const data = await r.json();
  if (!data || data.length < 2) return;

  const prices = data.map(k => +k[4]);
  const times = data.map(k => new Date(k[0]));

  // Timeframe % change
  const first = prices[0], last = prices[prices.length - 1];
  const change = ((last - first) / first) * 100;
  const tfName = sel.options[sel.selectedIndex].text;
  changeEl.innerHTML = `<span class="${change>=0?'up':'down'}">${change>=0?'+' : '−'}${Math.abs(change).toFixed(2)}%</span> (${tfName})`;

  draw(prices, times, tf);
}

function draw(prices, times, tf) {
  resize();
  const W = canvas.width / devicePixelRatio;
  const H = canvas.height / devicePixelRatio;
  ctx.clearRect(0, 0, W, H);

  const pad = 65;
  const cw = W - 2 * pad, ch = H - 2 * pad;
  const max = Math.max(...prices), min = Math.min(...prices), range = max - min || 1;

  // Area fill
  ctx.fillStyle = 'rgba(0,191,255,0.12)';
  ctx.beginPath();
  prices.forEach((p, i) => {
    const x = pad + i * cw / (prices.length - 1);
    const y = H - pad - ((p - min) / range) * ch;
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  });
  ctx.lineTo(W - pad, H - pad); ctx.lineTo(pad, H - pad); ctx.closePath(); ctx.fill();

  // Line
  ctx.strokeStyle = '#00bfff'; ctx.lineWidth = 2.3; ctx.beginPath();
  prices.forEach((p, i) => {
    const x = pad + i * cw / (prices.length - 1);
    const y = H - pad - ((p - min) / range) * ch;
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  });
  ctx.stroke();

  // Horizontal grid
  ctx.strokeStyle = '#003340';
  for (let i = 0; i <= 4; i++) {
    const y = pad + i * (ch / 4);
    ctx.beginPath(); ctx.moveTo(pad, y); ctx.lineTo(W - pad, y); ctx.stroke();
  }

  // Y-axis labels — NOW OUTSIDE ON THE RIGHT
  ctx.fillStyle = '#00bfff'; ctx.font = '14px monospace'; ctx.textAlign = 'left';
  for (let i = 0; i <= 4; i++) {
    const y = pad + i * (ch / 4);
    const val = max - i * (range / 4);
    ctx.fillText('$' + val.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ','), W - pad + 8, y + 6);
  }

  // X-axis labels
  ctx.textAlign = 'center';
  const count = 6;
  for (let i = 0; i <= count; i++) {
    const idx = Math.round(i * (prices.length - 1) / count);
    const x = pad + idx * cw / (prices.length - 1);
    const d = times[idx];
    let label = '';
    if (tf === '1h') label = d.toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit'}).replace(/:\d\d$/,'');
    else if (tf === '1d') label = d.getHours().toString().padStart(2,'0') + 'h';
    else if (tf === '7d' || tf === '30d') label = d.toLocaleDateString('en-US', {month:'short', day:'numeric'});
    else if (tf === 'ytd') label = d.toLocaleDateString('en-US', {month:'short', day:'numeric'});
    else label = d.getFullYear();
    ctx.fillText(label, x, H - pad + 24);
  }

  // Border
  ctx.strokeStyle = '#00bfff'; ctx.lineWidth = 1.5;
  ctx.strokeRect(pad, pad, cw, ch);
}

sel.onchange = () => load(sel.value);
updatePrice();
load('7d'); // Default 7D
setInterval(() => { updatePrice(); load(sel.value); }, 30000);
</script>
</body>
</html>
